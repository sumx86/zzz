var globalSettings={"loader-ico":'<i class="fa fa-spinner fa-spin" id="spinner"></i>',"alert-exit":'<i id="exit-alert" class="fa fa-times"></i>',"psi-template":'<div class="psi"></div>',"psi-states":{fail:0,close:1,done:2},"color-panel":{template:'<div id="color-panel" data-cl></div>',palette:'<div class="palette" data-cl><div class="inner" data-cl></div></div>',palettes:["6f62a1","564691","556b2f","ededed","bababa","5f7fad","405c85","59383a","5c2c2e","3b736e"]},ajax:{login:"/ajax/login",register:"/ajax/register","reset-pass":"/ajax/reset-pass",search:"/ajax/search",update:"/ajax/update",comment:"/ajax/comment",upload:"/ajax/upload"},routes:{home:"/",acc:"/account/uid/",members:"/members",sign:"/sign-in"},lang:{bg:{follow:"Ð¡Ð»ÐµÐ´Ð²Ð°Ð¹",unfollow:"Ð¡Ð¿Ñ€Ð¸"},en:{follow:"Follow",unfollow:"Unfollow"}}},SimpleModalEvents={init:function(t){$(document).on("click",t.trigger,t.handle),$._on(document,null,{keydown:function(e){"escape"==e.key.toLowerCase()&&$(t.target).hasClass("modal-active")&&$(t.trigger).click()},click:function(e){var i=e.target;$(t.target).hasClass("modal-active")&&!i.hasAttribute(t.uniq_d)&&$(t.trigger).click()}},null)}},Util={userImageHidePreview:function(){$("#user-image-preview-container > #inner").stop().animate({top:"-70%"},300).promise().done((function(){$("#user-image-preview-container").fadeOut("fast")}))},rescaleImage:function(t){var e=new Image;e.src=t.attr("src"),console.log(e.width+" -- "+e.height);var i=e.height-e.width,n={width:"",left:""};i>=300?n={width:"60%",left:"20%"}:i>=200?n={width:"75%",left:"12.5%"}:i>=100&&(n={width:"92%",left:"4%"}),""!=n.width&&t.css(n)},clearFields:function(t){$(t).each((function(t,e){$(e).val("")}))},animateFrame:function(t){var e=0,i=t.borderFrom,n=setInterval((function(){e==t.frames?clearInterval(n):(i=i==t.borderFrom?t.borderTo:t.borderFrom,$(t.element).css("border-color",i)),e++}),100)}};!function(t){t.extend(jQuery,{initCall:function(e,i){t.isFunction(i.initialize)&&(i.initialize.call(i),e&&console.log("Running initialize function of: '"+e+"' object"))},cancelEvent:function(e){e.preventDefault(),t.isFunction(e.stopPropagation)&&e.stopPropagation(),e.hasOwnProperty("cancelBubble")&&(e.cancelBubble=!0)},_on:function(e,i,n,a){var o=t.type(n);if("object"!=o)throw new TypeError("[jQuery._on()] Expected third argument of type `object`, `"+o+"` was passed instead.");t.each(n,(function(n,o){o=a?o.bind(a):o,i&&t(e).on(n,i,o)||t(e).on(n,o)}))},doAjax:function(e,i,n){var a=t.extend({url:"",async:!0,data:{},type:"post"},e);return i&&t("#spinner").css("display","block"),t.ajax(a)}}),t._isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},t.redirect=function(t){var e;return e="object"==typeof t?globalSettings.routes[t.getAttribute("data-name")]:t,(window.location.href=e)||window.location.assign(e)||window.location.replace(e)}}(jQuery),function(t){t.corePlugin=t.corePlugin||{},t.corePlugin.alert=t.corePlugin.alert||{},t.corePlugin.alert.callbacks={},t.corePlugin.alert.self=null,t.corePlugin.alert.show=function(t,e){this.init(t,e.callback)},t.corePlugin.alert.hide=function(e,i){t("#alert-box").remove()},t.corePlugin.alert.init=function(e,i){var n="<div id='alert-box'><div id='alert-box-text-box'><span id='text'>"+e+"</span></div>";i.hasOwnProperty("yes")&&(this.callbacks.yes=i.yes,n+="<button id='alert-box-button-yes' data-action='yes'>"+window.text.yes[window.lang]+"</button>"),i.hasOwnProperty("no")&&(this.callbacks.no=i.no,n+="<button id='alert-box-button-no' data-action='no'>"+window.text.no[window.lang]+"</button>"),i.hasOwnProperty("ok")&&(this.callbacks.ok=i.yes,n+="<button id='alert-box-button-ok' data-action='ok'>"+window.text.ok[window.lang]+"</button>"),n+="</div>",this.self=t(t.parseHTML(n)[0]),t("body").find("div:first").append(this.self),this.setup()},t.corePlugin.alert.setup=function(){var e=this;this.self.on("click","[data-action]",this._click),t(document).keydown((function(t){"escape"==t.key.toLowerCase()&&e.self.find('[data-action="no"]').focus().click()}))},t.corePlugin.alert._click=function(e){switch(t(e.target).attr("id").split("-")[3]){case"yes":t.corePlugin.alert.callbacks.yes();break;case"no":t.corePlugin.alert.callbacks.no();break;case"ok":t.corePlugin.alert.callbacks.ok()}}}(jQuery),jQuery,$(document).ready((function(){/platform=ps3/.test(location.href)&&($(".collection-item").css("height","26%"),$("#preview > #game-cover").css("height","63%"),$("#item-actions").css("top","68.5%"))})),function(t){t(document).ready((function(){t(".lang-img-container > img").click((function(){cookieUtil.create({name:"lang",value:t(this).parent().attr("data-lang").toLowerCase(),path:"/",days:365}),location=location.href})),t("#halloween-theme").click((function(){var t="";t="halloween"!=cookieUtil.get("theme")?"halloween":"none",cookieUtil.create({name:"theme",value:t,path:"/",days:365}),location=location.href})),"halloween"==cookieUtil.get("theme")&&(t("[data-theme]").each((function(e,i){var n=t(i),a=n.text();n.attr("style","font-family: Frightmare, whirlcyr2"),/[\u0400-\u04FF]+/.test(a)||(n.css("font-size",n.attr("data-fontsize")),n.css("top",n.attr("data-mgtop")))})),t("#site-name > #name-text").css("top","9%"))}))}(jQuery),function(t){t(document).ready((function(){t("#sign-out > i:first").click((function(e){t("#logout-confirmation-modal").css("display","flex").animate({top:0}).promise().done((function(){Util.animateFrame({borderFrom:"#a11443",borderTo:"#241b44",element:"#logout-confirmation-modal",frames:"8"}),t("#confirmation-buttons > #yes > span:first").click((function(){t.redirect("/ajax/logout")})),t("#confirmation-buttons > #no > span:first").click((function(){t("#logout-confirmation-modal").animate({top:"-9.3%"}).css("display","flex")}))}))}))}))}(jQuery),function(t){t(document).ready((function(){t("#login-button").click((function(){t.redirect("/sign-in")})),t("[data-acc]").click((function(){t.redirect(globalSettings.routes.acc+parseInt(t(this).attr("data-uid")))})),t(".page-item").click((function(){var e,i=t(this),n=i.parent().parent(),a=n.attr("data-action");if(!i.hasClass("no-redirect")){var o=parseInt(i.find("span").first().text());switch(a){case"collection":e="/collection?page="+o+"&platform="+n.attr("data-platform");break;case"members":e="/members?page="+o}t.redirect(e)}}))}))}(jQuery),function(t){t.initCall("toggle-collection-containers",{initialize:function(){t(document).on("click",".platform",(function(){t.redirect("/collection?page=1&platform="+t(this).attr("id"))}))}})}(jQuery),function(t){t.initCall("comment-like-handling",{initialize:function(){t(document).on("preview-comments-loaded",this._registerLikeEvent.bind(this))},_registerLikeEvent:function(){var e=this;t(".comment-actions").find(".like-comment").click((function(t){e._doUpdate(t)}))},_doUpdate:function(e){var i=this,n=t(e.currentTarget),a=n.attr("class").split(" ");t.doAjax({url:globalSettings.ajax.update,data:"action=like&data="+JSON.stringify({item:parseInt(a[a.length-1]),item_type:"comment"})},!1).done((function(e,a,o){if(console.log("[COMMENT-LIKE-HANDLING-MODULE] -> "+e),"success"==a&&0==e.indexOf("{")){var s=t.parseJSON(e);s.hasOwnProperty("success")?i._updateContent(s,n):i._handleError()}}))},_updateContent:function(t,e){var i=t.success;e.parent().find("span:first").text(i.result[0].comment_likes)},_handleError:function(){t("html, body").animate({scrollTop:0},"slow").promise().done((function(){t("#comment-rate-warning").css("display","flex").delay(2e3).hide("fast")}))}})}(jQuery),function(t){t.initCall("comment-reply-handling",{initialize:function(){t(document).on("preview-comments-loaded",this._registerCommentActions.bind(this))},_registerCommentActions:function(e){var i=this;t(".comment-actions").find(".reply > span:first").click((function(t){window._login?console.log("reply-login"):i._handleError()}))},_handleError:function(){t("html, body").animate({scrollTop:0},"slow").promise().done((function(){t("#comment-rate-warning").css("display","flex").delay(2e3).hide("fast")}))}})}(jQuery),function(t){t.initCall("comment-editing-handling",{_modal:".emoji-container",_commentID:null,_itemID:null,_editBlockIndex:null,initialize:function(){t(document).on("preview-comments-loaded",this._registerCommentEditActions.bind(this))},_registerCommentEditActions:function(e){var i=this;this._registerSubmitEvents(),t(".comment-edit-action-button > i").click((function(){var e=t(this).parent().parent(),n=e.attr("class").split(" ");i._commentID=n[1],i._itemID=n[2],i._editBlockIndex=e.attr("data-fl-idx"),"delete"==t(this).parent().attr("class").split(" ")[0]?(i._scrollToTheTop(),i._promptCommentRemoval(window.text["comment-removal"][window.lang])):i._showEditField(i._editBlockIndex)})),t(".emoji-trigger").click((function(e){t("#emoji-container").clone().removeAttr("id").attr("class","emoji-container").css("display","block").appendTo(t(this).parent()),SimpleModalEvents.init({target:".emoji-container",trigger:".emoji-trigger",uniq_d:"data-gr",handle:i._toggleModal.bind(i)})}))},_updateData:function(e,i){var n=this;t.doAjax({url:globalSettings.ajax.comment,data:"action="+e+"&data="+JSON.stringify({item:n._commentID,item_type:"comment",text:i,game_id:n._itemID})},!1).done((function(i,a,o){if("success"==a&&0==i.indexOf("{")){var s=t.parseJSON(i);if(s.hasOwnProperty("success"))switch(e){case"delete":n._removeCommentBoxWithId(n._commentID);break;case"edit":n.updateUI(s.success)}}}))},updateUI:function(e){var i=e.item,n=e.text;t("[data-cbox="+i+"]").find(".inner > .comment > .inner > span:first").text(n),t("[data-ebox="+i+"]").css("display","none")},_removeCommentBoxWithId:function(e){t(".box-"+e).remove()},_promptCommentRemoval:function(e){var i=this;t.corePlugin.alert.show(e,{callback:{yes:function(){i._updateData("delete"),t.corePlugin.alert.hide()},no:function(){t.corePlugin.alert.hide()}}},!0)},_registerSubmitEvents:function(){var e=this;t(".submit-btn").on("mousedown",(function(e){var i=t(e.currentTarget);i.find("i:first").css("color",i.attr("data-color-o"))})).on("mouseup",(function(i){var n=t(i.currentTarget);n.find("i:first").css("color",n.attr("data-color-i")),n.hasClass("edit-submit")&&e._updateData("edit",n.parent().find(".inner:first > textarea:first").val()),n.hasClass("edit-cancel")&&n.parent().css("display","none")})).on("mouseout",(function(e){var i=t(e.currentTarget);i.find("i:first").css("color",i.attr("data-color-i"))}))},_showEditField:function(e){t(".comment-edit-box").each((function(i,n){var a=t(n),o=a.attr("data-fl-idx");null==o||o!=e||a.css("display","block").find("textarea").val("")}))},_scrollToTheTop:function(){t("html, body").animate({scrollTop:0},"slow")},_toggleModal:function(e){var i=t(this._modal);console.log(this._isActive()),this._isActive()?(i.stop().fadeOut(200),i.removeClass("modal-active")):(i.stop().fadeIn(200),i.addClass("modal-active"))},_isActive:function(){return t(this._modal).hasClass("modal-active")}})}(jQuery),function(t){t.initCall("preview-views-handling",{initialize:function(){t(document).on("preview-update-views",this._updateViews.bind(this))},_updateViews:function(e,i){var n=this;t.doAjax({url:globalSettings.ajax.update,data:"action=view&data="+JSON.stringify({item:parseInt(i.item),item_type:"game"})},!1).done((function(e,a,o){if(console.log("[PREVIEW-VIEWS-HANDLING-MODULE] -> "+e),"success"==a&&0==e.indexOf("{")){var s=t.parseJSON(e);s.hasOwnProperty("success")&&n._updateContent(s,i.item)}}))},_updateContent:function(e,i){var n=e.success.result[0].views;t("#item-actions > #views > span > span:first").text(n),t(".collection-item").each((function(e,a){var o=t(a).attr("class").split(" ")[1];i==o&&(t(a).find(".collection-item-slider:first > .views:first").attr("data-count",n),t(a).find(".collection-item-slider:first > .views:first > span:first > span:first").text(n))}))}})}(jQuery),function(t){t.initCall("game-preview-control",{_exitElement:"#exit-preview",_previewContainer:"#game-preview-container",initialize:function(){var e=this;t(document).on("preview-comments-load",this._loadComments.bind(this)),t(document).ready((function(){t(e._exitElement).click((function(){t(e._previewContainer).css("display","none"),t(".comment-box, .comment-edit-box, #scrolltop-caret").remove(),t("#comment-section").css("display","none"),t("#no-comments").css("display","none")})),t(".collection-item").click((function(){var i=t(this).attr("class").split(" ")[1];t(e._previewContainer+" > #preview > #game-cover > img:first").attr("src",t(this).find(".cover:first > img").attr("src")),t(e._previewContainer+" > #preview > #top > #inner > span").text(t(this).attr("data-name")),t("#item-actions > #likes,#item-actions > #favourited").attr("class","action-button "+i),t("#item-actions > #likes > span > span:first").text(t(this).find(".collection-item-slider > .likes").attr("data-count")),t("#item-actions > #favourited > span > span:first").text(t(this).find(".collection-item-slider > .favourited").attr("data-count")),t("#item-actions > #comments > span > span:first").text(t(this).find(".collection-item-slider > .comments").attr("data-count")),t("#item-actions > #views > span > span:first").text(t(this).find(".collection-item-slider > .views").attr("data-count"));var n=t.parseJSON(t(this).attr("data-metadata"));t("#item-information > #inner > #uploader  > #image > img:first").attr("src",t(this).attr("data-uploader-image")),t("#item-information > #inner > #uploader  > #display-name > span:first").text(t(this).attr("data-uploader")),t("#item-information > #inner > #game-info > #release-date > span").eq(1).find("span:first").text(n["release-dates"]),t("#item-information > #inner > #game-info > #genre        > span").eq(1).find("span:first").text(n.genres),t("#item-information > #inner > #game-info > #platforms    > span").eq(1).find("span:first").text(n.platforms),t("#item-information > #inner > #game-info > #developers   > span").eq(1).find("span:first").text(n.developers),t("#item-information > #inner > #game-info > #publishers   > span").eq(1).find("span:first").text(n.publishers);var a="";a="None"!=n.iso?"Iso: <a href='"+n.iso+"' target='_blank'>link</a>":"Iso: No link",t("#item-information > #inner > #game-info > #iso     > #iso-span").html(a),t(".uploader-data").attr("data-uid",t(this).attr("data-uploaderid")),t(e._previewContainer).css("display","block"),t("#lang-container").css("z-index","5"),t("#comment-section").css("display","block"),t(document).trigger("preview-comments-load",[{item:i}]),t(document).trigger("preview-update-views",[{item:i}]),t("#comment-submit").attr("data-item",i)}))}))},_loadComments:function(e,i){var n=this;t.doAjax({url:globalSettings.ajax.comment,data:"action=load&data="+JSON.stringify({item:i.item})},!0).done((function(e,i,a){if(console.log("[GAME-PREVIEW-CONTROL-MODULE] -> "+e),"success"==i&&0==e.indexOf("{")){var o=t.parseJSON(e);o.hasOwnProperty("success")&&n._updateCommentsSection(o)}t("#spinner").css("display","none")}))},_updateCommentsSection:function(e){var i=e.success;if(i.length<=0)return t("#no-comments").css("display","block"),void t("#scrolltop-caret").css("display","none");for(var n=0;n<i.length;n++){var a="<div class='comment-box x"+i[n].comment.user_id+" box-"+i[n].comment.comment_id+"' data-fl-idx="+n+" data-cbox="+i[n].comment.comment_id+">                    <div class='inner'>                        <div class='user-pic'>                            <img src='"+i[n].comment.image+"'>                        </div>                        <div class='comment-info-top'>                            <div class='username info'>                                <span>"+i[n].comment.username+"</span>                            </div>                            <div class='comment-date info'>                                <span>"+i[n].comment.date+"</span>                            </div>                            <div class='comment-actions info'>                                <div class='like'>                                    <span><i class='fa fa-thumbs-up like-comment "+i[n].comment.comment_id+"' data-action='like' data-url='update'></i> <span> "+i[n].comment.likes+"</span></span>                                </div>                                <div class='reply'>                                    <span>"+i[n].comment["reply-meta"]+"</span>                                </div>";a+=1==i[n].comment.delete&&1==i[n].comment.edit?"<div class='comment-edit "+i[n].comment.comment_id+" "+i[n].comment.item_id+"' data-fl-idx="+n+">                                    <div class='edit comment-edit-action-button'>                                        <i class='fa fa-edit'></i>                                    </div>                                    <div class='delete comment-edit-action-button'>                                        <i class='fa fa-trash-o'></i>                                    </div>                                </div>":"",a+="</div>                        </div>                        <div class='comment'>                            <div class='inner'>                                <span>"+i[n].comment.text+"</span>                            </div>                        </div>                    </div>                </div>",a=t.parseHTML(a),t(a).css("display","block"),t("#comment-section > #inner").append(a),this._addEditBlock("#comment-section > #inner",i[n].comment.user_id,i[n].comment.comment_id,n)}i.length>=2&&t("#comment-section > #inner").append('<i id="scrolltop-caret" class="fa fa-caret-up"></i>'),t(document).trigger("preview-comments-loaded",[])},_addEditBlock:function(e,i,n,a){var o=t.parseHTML("<div class='comment-edit-box x-"+i+" box-"+n+"' data-fl-idx="+a+" data-ebox="+n+">                                        <div class='inner'>                                            <div class='header'>                                                <span>"+window.text.edit[window.lang]+"</span>                                            </div>                                            <textarea class='comment-edit-input-field'></textarea>                                        </div>                                        <div class='edit-submit submit-btn' data-color-i='#fc5603' data-color-o='#ffffff'>                                            <i class='fa fa-check'></i>                                        </div>                                        <div class='edit-cancel submit-btn' data-color-i='#ffffff' data-color-o='#ff2c49'>                                            <i class='fa fa-times'></i>                                        </div>                                        <div class='emoji-trigger' data-gr>                                            <span data-gr>ðŸ™‚</span>                                        </div>                                    </div>");t(o).append(t("#emoji-container").clone().removeAttr("id").attr("class","emoji-container")),t(e).append(o)}})}(jQuery),function(t){t.initCall("collection-item-action-buttons",{_parent:null,initialize:function(){var e=this;t(document).on("collection-item-stats-update",this._updateContent.bind(this)),t(document).on("collection-item-stats-error",this._handleError.bind(this)),t(document).ready((function(){t('.action-button:not(".no-action") > span').find("i:first").click((function(t){e._doUpdate(t)}))}))},_doUpdate:function(e){var i=t(e.currentTarget);this._parent=i.parent().parent(),t.doAjax({url:globalSettings.ajax.update,data:"action="+this._parent.attr("data-action")+"&data="+JSON.stringify({item:parseInt(this._parent.attr("class").split(" ")[1]),item_type:"game"})},!1).done((function(e,n,a){if("success"==n&&0==e.indexOf("{")){var o=t.parseJSON(e);o.hasOwnProperty("success")?t(document).trigger("collection-item-stats-update",[{response:o,target:i}]):t(document).trigger("collection-item-stats-error",[{response:o,target:i}])}}))},_updateContent:function(e,i){var n=i.response.success,a=this._parent.attr("class").split(" ")[1];switch(n.action){case"like":var o=n.result[0].likes;t("#item-actions > #likes > span > span:first").text(o),t(".collection-item").each((function(e,i){var n=t(i).attr("class").split(" ")[1];a==n&&(t(i).find(".collection-item-slider:first > .likes:first").attr("data-count",o),t(i).find(".collection-item-slider:first > .likes:first > span:first > span:first").text(o))}));break;case"favourite":var s=n.result[0].favourited;t("#item-actions > #favourited > span > span:first").text(s),t(".collection-item").each((function(e,i){var n=t(i).attr("class").split(" ")[1];a==n&&(t(i).find(".collection-item-slider:first > .favourited:first").attr("data-count",s),t(i).find(".collection-item-slider:first > .favourited:first > span:first > span:first").text(s))}))}},_handleError:function(e,i){"login"==i.response.error&&t("#account-login-first").css("display","flex").delay(2e3).hide("fast")}})}(jQuery),function(t){t.initCall("collection-item-post-comment",{initialize:function(){var e=this;t(document).ready((function(){t._on("#comment-submit",null,{mousedown:function(e){t(e.currentTarget).find("i:first").css("color","white")},mouseup:function(e){var i=t(e.currentTarget);i.find("i:first").css("color","#fc5603"),t.doAjax({url:globalSettings.ajax.comment,data:"action=post&data="+JSON.stringify({item:i.attr("data-item"),text:t("#collection-item-comment-input-field").val()})},!1).done((function(e,i,n){"success"==i&&(0==e.indexOf("{")&&t.parseJSON(e).hasOwnProperty("success")&&location.reload())}))}},e)}))}})}(jQuery),function(t){t.initCall("post-comment-options",{_modal:"#emoji-container",_commentField:"#collection-item-comment-input-field",initialize:function(){var e=this;t(document).ready((function(){t("#add-link").click((function(){t(e._commentField).val(t(e._commentField).val()+"[link]http://example.com[/link]")})),t(".comment-icon").click((function(){t(e._commentField).val(t(e._commentField).val()+t(this).html())}))})),SimpleModalEvents.init({target:"#emoji-container",trigger:"#emoji-smiley",uniq_d:"data-gr",handle:this._toggleModal.bind(this)})},_toggleModal:function(e){var i=t(this._modal);console.log(this._isActive()),this._isActive()?(i.stop().fadeOut(200),i.removeClass("modal-active")):(i.stop().fadeIn(200),i.addClass("modal-active"))},_isActive:function(){return t(this._modal).hasClass("modal-active")}})}(jQuery),function(t){t.initCall("games-filtering",{_modal:"#game-filters-container",initialize:function(){SimpleModalEvents.init({target:"#game-filters-container",trigger:"#filter-games-trigger",uniq_d:"data-gr",handle:this._toggleModal.bind(this)})},_toggleModal:function(e){var i=t(this._modal);console.log(this._isActive()),this._isActive()?(i.stop().fadeOut(200),i.removeClass("modal-active")):(i.stop().fadeIn(200),i.addClass("modal-active"))},_isActive:function(){return t(this._modal).hasClass("modal-active")}})}(jQuery),function(t){t.initCall("game-upload-module",{_lastError:"",_files:null,initialize:function(){var e=this;t(document).ready((function(){t(document).on("game-preview-done",e._registerSubmitEvent.bind(e)),t("#game-upload-container > #top > #exit-preview").click((function(){t(this).parent().parent().css("display","none"),t(".game-upload-field").val(""),t("#upload-game-form")[0].reset()})),t(".game-upload-tooltip-trigger").click((function(){e._toggleFieldInfoTooltip(t(this).attr("data-target"))})),e._handleFileUpload()}))},_toggleFieldInfoTooltip:function(e){var i=e+"-tooltip",n=this;t(".game-upload-field-info-tooltip").each((function(e,a){t(a).attr("id")!=i?t(a).css("display","none"):n._toggleTooltip(i)}))},_toggleTooltip:function(e){var i="#"+e,n="block"==t(i).css("display")?"none":"block";t(i).css("display",n)},_handleFileUpload:function(){var e=this;t(":file").on("change",(function(){e._files=this.files,e._checkIsLegitFile(this.files),""!=e._lastError?e._showError(e._lastError,this.files[0].name):e._tryTriggerPreview(this.files[0])}))},_checkIsLegitFile:function(e){var i=e[0].name.split(".");-1==t.inArray(i[i.length-1],["jpeg","jpg","png"])?this._lastError="extension-error":e[0].type.match(/image/)?this._lastError="":this._lastError="file-type-error"},_registerSubmitEvent:function(){t("#submit-game-upload").on("click",this._proceedUpload.bind(this))},_proceedUpload:function(){var e=this;if(t("#upload-spinner").css("display","flex"),t("#upload-error").css("display","none").stop(),"undefined"!=typeof FormData){var i=new FormData;i.append("file",this._files[0]),i.append("metadata",t("#metadata-form").serialize()),t.doAjax({url:"/ajax/upload",data:i,dataType:"text",cache:!1,contentType:!1,processData:!1}).done((function(i,n,a){if(console.log(i),"success"==n&&0==i.indexOf("{")){var o=t.parseJSON(i);o.hasOwnProperty("success")?e._handleServerMessage(o.success,"success"):e._handleServerMessage(o.error,"error")}t("#upload-spinner").css("display","none")}))}},_tryTriggerPreview:function(e){if("undefined"!=typeof FileReader){var i=new FileReader;i.onload=function(e){var i=e.target;t("#game-upload-container").css("display","block"),t("#game-upload-cover").css("background-image","url("+i.result+")"),t("#game-upload-cover").css("background-size","cover"),t("#game-upload-cover").css("background-position","center center"),t(document).trigger("game-preview-done",{})},i.readAsDataURL(e)}},_showError:function(t,e){switch(t){case"extension-error":console.log("extension error -> "+e);break;case"file-type-error":console.log("file-type error -> "+e)}},_clearFields:function(){t(".game-upload-field").val("")},_handleServerMessage:function(e,i){t("#upload-error").find("span:first").html(e),t("#upload-error").css("display","flex").delay(5e3).hide("slow"),"success"==i&&this._clearFields()}})}(jQuery),function(t){t.initCall("user-follow-module",{initialize:function(){var e=this;t(document).ready((function(){t(".follow-button, .unfollow").click((function(){var i=t(this);t.doAjax({url:"/ajax/followuser",data:"data="+JSON.stringify({id:t(this).attr("class").split("-").pop()})},!0,null).done((function(n,a,o){n&&(t.parseJSON(n).hasOwnProperty("success")&&e._toggleButton(i))}))}))}))},_toggleButton:function(t){var e=t.attr("class").split(" ");"follow-button"==e[0]?t.attr("class","unfollow "+e[1]).find("span:first").html("<i class='fa fa-user'></i> "+globalSettings.lang[window._lang].unfollow):t.attr("class","follow-button "+e[1]).find("span:first").html("<i class='fa fa-user'></i> "+globalSettings.lang[window._lang].follow)}})}(jQuery),function(t){t.initCall("user-blocking-module",{initialize:function(){t(document).ready((function(){t(".block-user-button, .unblock-user-button").click((function(){t.doAjax({url:"/ajax/block",data:"data="+JSON.stringify({id:t(this).attr("class").split("-").pop()})},!0,null).done((function(t,e,i){console.log(t)}))}))}))}})}(jQuery),function(t){t.initCall("user-settings",{initialize:function(){var e=this;t(document).ready((function(){t(".basic-info-section > .heading, .basic-info-section > .subtext").click((function(){var i=t(this).parent();e._slideToggle(i)})),t("#confirm-changes").click((function(){t("#spinner").css("display","block"),e._saveAccountSettings([".overall-info-field",".social-media-input-field"])})),t._on(document,null,{click:function(e){"block"==t("#settings-container-section").css("display")&&null!=t(e.target).attr("data-gr")&&(t("#user-data").scrollTop(0),t("#settings-container-section").hide())},keydown:function(e){"escape"==e.key.toLowerCase()&&"block"==t("#settings-container-section").css("display")&&(t("#user-data").scrollTop(0),t("#settings-container-section").hide())}},null)}))},_slideToggle:function(t){var e=t.attr("data-initial-px"),i=t.attr("data-slide-px");switch(t.css("height")){case e:t.animate({height:i},"fast").promise().done((function(){t.find(".cnt:first").css("display","flex")}));break;case i:t.animate({height:e},"fast").promise().done((function(){t.find(".cnt:first").css("display","none")}))}},_saveAccountSettings:function(e){var i={};t(e).each((function(e,n){t(n).each((function(e,n){var a=t(n).val();a&&(i[t(n).attr("name")]=a)}))})),this._resetErrors(),this._saveData(JSON.stringify(i))},_saveData:function(e){var i=this;t.doAjax({url:"/ajax/update",data:"action=user&id="+parseInt(window._uid)+"&data="+e},!0,null).done((function(e,n,a){if(e){var o={email:new RegExp('"email":"(.+)("}}.*)',"g").exec(e),password:new RegExp('"password":"(.+)("}}.*)',"g").exec(e)};-1!=e.indexOf('{"success":')?console.log("a"):i._handleErrors(o)}t("#spinner").css("display","none")}))},_handleErrors:function(e){t(Object.keys(e)).each((function(i,n){var a=e[n];if(a){var o=-1!=a[1].indexOf('"}}')?a[1].substring(0,a[1].indexOf('"}}')):a[1];t("#"+n+"-update > #"+n+"-error").css("display","flex").find("span:first").text(o)}}))},_resetErrors:function(){t("#email-update > #email-error").hide().find("span:first").text(""),t("#password-update > #password-error").hide().find("span:first").text("")}})}(jQuery),function(t){t.initCall("delete-user-account",{initialize:function(){t(document).ready((function(){t("#submit-deletion").click((function(){t("#confirm-deletion").show().promise().done((function(){Util.animateFrame({borderFrom:"#2f394d",borderTo:"#f85149",element:"#confirm-deletion",frames:"8"}),t("#user-data").animate({scrollTop:t(window).height()+2e3},"slow")})),t("#confirm-deletion > #buttons > #yes").click((function(){t.doAjax({url:"/ajax/delete-account",data:"id="+parseInt(window._uid)},!0,null).done((function(t,e,i){console.log(t)}))})),t("#confirm-deletion > #buttons > #no").click((function(){t("#confirm-deletion").hide()}))}))}))}})}(jQuery),function(t){t.initCall("update-user-info",{_editor:".info-edit-block",_active:!1,initialize:function(){t(document).on("click",'[data-role="edit-user-info"]',this._toggleContentEditor.bind(this)),t(document).on("click",'[data-role="update-user"]',this._update.bind(this)),t(document).on("user-info-update",this._updateContent.bind(this))},_toggleContentEditor:function(e){if(this._isActiveModal()){var i=this;t(this._editor).find("#inner > #content").hide("fast"),setTimeout((function(){t(i._editor).find("#inner").stop().animate({height:"0px"},"fast"),i._active=!1}),200)}else t(this._editor).find("#inner > #content").show("fast"),t(this._editor).find("#inner").stop().animate({height:"420px"}),this._active=!0},_getInputData:function(){var e={accounts:{}};return t(".info-field").each((function(i,n){let a=n.getAttribute("name");("account-list-item"==n.getAttribute("data-role")?e.accounts:e)[a]=t(n).val()})),e},_update:function(e){var i=t(e.currentTarget);this._toggleSubmitLock();t.doAjax({url:globalSettings.ajax[i.attr("data-action")],data:JSON.stringify(this._getInputData())+"user-info-update"},!0,i).done((function(e,n,a){var o=t.parseJSON(e);t(document).trigger("user-info-update",[{response:o,target:i}])})).fail((function(e){t.corePlugin.alert.show(e,{callback:{ok:function(){t.redirect(window.location.href)}}},!0)}))},_updateContent:function(t,e){console.log(e),this._toggleSubmitLock()},_toggleSubmitLock:function(){t('[data-role="update-user"]').prop("disabled",(function(t,e){return!e}))},_isActiveModal:function(){return this._active}})}(jQuery),function(t){t.initCall("form-handling",{initialize:function(){t(window).on("load",this._initializeInputErrors.bind(this)),t._on(document,"#login-form, #registration-form, #reset-pass-form, #comment-form",{submit:this._formSubmit},this)},_initializeInputErrors:function(){t(".input-field").each((function(e,i){var n=t(this),a=n.parent().attr("data-action");if("login"==a||"register"==a||"reset-pass"==a){var o=t.parseHTML("<span style='display: none;'>what teh cuck</span>");t(o).attr("id",n.attr("name")+"-error"),t("#main-container").append(o)}}))},_formSubmit:function(e){t.cancelEvent(e);var i=t(e.currentTarget);this._toggleSubmitLock(),this._resetInputFields(i);var n=this;t.doAjax({url:globalSettings.ajax[i.attr("data-action")],data:i.serialize()},!0,i).done((function(e,i,a){if(console.log(e),0==e.indexOf("{")){var o=t.parseJSON(e);o.hasOwnProperty("success")?t.redirect(globalSettings.routes.home):n._handleError(o["input-error"])}t("#spinner").css("display","none"),n._toggleSubmitLock()})).fail((function(e){t.corePlugin.alert.show(e,{callback:{ok:function(){t.redirect(window.location.href)}}},!0)}))},_toggleSubmitLock:function(){t(document).find("[data-action='login'],[data-action='register'],[data-action='reset-pass']").each((function(e,i){t(i).find("button").prop("disabled",(function(t,e){return!e}))}))},_handleError:function(e){var i=this;Object.keys(e).length>0&&t.each(e,(function(e,n){t("input[name='"+e+"']").css("border","1px solid #a11443").addClass("error"),""!=n&&i._showError(e,n)}))},_showError:function(e,i){if(e.indexOf("register")>=0){var n=t("#sign-up-errors-container").find("#"+e+"-error").first();n.append("<span>"+i+"</span><i class='fa fa-times remove-error'></i>"),this._registerExitErrorEvent(n),n.css("display","flex")}else t("#"+e+"-error").css("display","block").text(i)},_registerExitErrorEvent:function(e){e.find(".remove-error").click((function(){var e=t(this).parent();e.find("span").first().text(""),e.hide("fast")}))},_resetInputFields:function(e){e.find("input").each((function(e,i){t(i).css("border","1px solid #738399").removeClass("error"),t("#"+t(i).attr("name")+"-error").css("display","none").text("")}))}})}(jQuery);